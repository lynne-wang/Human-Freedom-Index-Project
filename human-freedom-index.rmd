---
title: "Human Freedom Index Project"
author: "Team Platypus: Lynne Wang, Neel Gajjar, Kate Neal"
output: pdf_document
---

```{r packages-data, warning=FALSE, message=FALSE}
library(tidyverse)
library(ggplot2)
library(dplyr)
require(maps)
require(viridis)
theme_set(
  theme_gray()
  )
hfi <- read_csv("data/hfi_cc_2019.csv") 
```

```{r glimpse}
glimpse(hfi)
```

### Question 1

How has overall freedom around the world changed over time?

```{r q1, warning=FALSE, message=FALSE}
hfscore_by_year <- hfi %>% 
  filter(hf_score != "-") %>% 
  group_by(year) %>% 
  summarize(mean_hf = mean(as.numeric(hf_score)))

ggplot(data = hfscore_by_year, 
       aes(x = as.factor(year), y = mean_hf, group = 1)) +
  geom_line(stat = "identity") +
  ylim(6.75, 7.25) + 
  labs(x = "Year", y = "Human Freedom Score", 
       title = "Overall Human Freedom on the Decline",
       subtitle = "2008 to 2017")
```

### Average Freedom Around the World
```{r freedom-map}
summarized_hfi <- hfi %>% 
  filter(hf_score != "-") %>% 
  group_by(countries) %>% 
  mutate(mean_hf = mean(as.numeric(hf_score))) %>% 
  slice(1) %>% 
  mutate(countries = ifelse(countries == "United States", "USA", countries)) %>% 
  summarize(countries, mean_hf)

world_map <- map_data("world")
freedom_map <- left_join(world_map, summarized_hfi, by = c("region" = "countries"))

# Create the map
ggplot(freedom_map, mapping = aes(long, lat, group = group)) +
  coord_fixed(1.3) +
  geom_polygon(aes(fill = as.numeric(mean_hf)), color = "white") +
  scale_fill_distiller(palette ="RdBu", direction = 1)
```

### ===========================================================================
### Economic and Personal Freedom

How do different countries' economic and personal freedom scores compare?

```{r economic-and-personal-freedom}
no_na_hfi <- hfi %>% 
  filter(pf_score != "-" & ef_score != "-")

clean_hfi <- no_na_hfi %>% 
  group_by(countries) %>% 
  mutate(mean_pf = mean(as.numeric(pf_score)),
         mean_ef = mean(as.numeric(ef_score))) %>% 
  mutate(diff_ef_pf = mean_ef - mean_pf) %>% 
  slice(1) %>% 
  summarize(countries, mean_ef, mean_pf, diff_ef_pf)

mean_diff <- clean_hfi %>% 
  summarize(mean_diff = mean(diff_ef_pf))

ggplot(data = clean_hfi, aes(x = diff_ef_pf)) +
  geom_histogram(bins = 30) +
  geom_vline(linetype = "dashed", xintercept = c(mean_diff$mean_diff)) +
  labs(x = "Difference in Economic and Personal Freedom Score", 
       y = "Count", 
       title = "Histogram of Differences in Economic and Personal Freedom Score",
       subtitle = "Average Diffs from 2008 to 2017, 162 Countries")
```

### Economic and Personal Freedom Differences - Bootstrap Simulation

On average, is there a difference between a country's economic freedom score and personal freedom score?

Null Hypothesis: the difference between mean economic freedom score and mean personal freedom score is greater than or equal to zero.

Alternative Hypothesis: the difference between mean economic freedom score and mean personal freedom score is less than zero.

$H_0$: $\mu$ $\geq$ 0

$H_A$: $\mu$ < 0

```{r bootstrap-ef-pf-95-conf}
set.seed(10)
n_sims <- 500
boot_dist = numeric(n_sims) 
for(i in 1:n_sims){ 
  indices <- sample(1:nrow(clean_hfi), replace = T)
  boot_mean <- clean_hfi %>% 
    slice(indices) %>%                    
    summarize(boot_mean = mean(diff_ef_pf)) %>% 
    pull()                                
  boot_dist[i] <- boot_mean 
}

boot_means = tibble(boot_dist)
mu_0 <- 0
offset <- boot_means %>% 
  summarize(mu_0 - mean(boot_dist)) %>%
  pull()
boot_means <- boot_means %>%
  mutate(shifted_means = boot_dist + offset)
boot_1 <- boot_means%>%
  summarize(lower = quantile(shifted_means, 0.025), 
            upper = quantile(shifted_means, 0.975))
boot_1
```

```{r bootstrap-ef-pf-obs-diff}
obs_mean <- clean_hfi %>% 
  summarize(mean(diff_ef_pf)) %>% 
  pull()
obs_mean
```

```{r bootstrap-ef-pfp-val}
obs_diff <- mu_0 - obs_mean
boot_means %>% 
  mutate(extreme = ifelse(shifted_means <= mu_0 - obs_diff |
                          shifted_means >= mu_0 + obs_diff, 1, 0)) %>% 
  summarize(p_val = mean(extreme))
```

```{r bootstrap-ef-pf-visualization, warning=FALSE, message=FALSE}
ggplot(data = boot_means, aes(x = shifted_means)) +
  geom_histogram(color = "darkblue", fill = "skyblue") + 
  labs(x = "Difference in Economic and Personal Freedom Score", y = "Count", 
       title = "Sufficient Evidence to Suggest Difference Between 
       Economic and Personal Freedom Scores is Less than Zero",
       subtitle = "500 bootstrap reps with Observed Prop and 95% CI shown") +
  geom_vline(xintercept = c(boot_1$lower, boot_1$upper),
             color = "red") +
  geom_vline(linetype = "dashed", xintercept = c(mean_diff$mean_diff))
```

Our p-value is 0, and so we reject the null hypothesis at the $\alpha$ = 0.05 significance level. There is sufficient evidence to suggest that the difference between mean economic freedom score and mean personal freedom score is less than zero. In other words, on average, economic freedom scores tend to be lower than personal freedom scores around the world.

### Economic and Personal Freedom Difference By Region

```{r region-economic-personal-diff, warning=FALSE, message=FALSE}
region_hfi <- no_na_hfi %>% 
  group_by(region) %>% 
  mutate(mean_pf = mean(as.numeric(pf_score)),
         mean_ef = mean(as.numeric(ef_score))) %>% 
  mutate(diff_ef_pf = mean_ef - mean_pf,
         score = ifelse(diff_ef_pf > 0, 
                        "ef_score > pf_score", "ef_score < pf_score")) %>% 
  slice(1) %>% 
  summarize(region, mean_ef, mean_pf, diff_ef_pf, score)

ggplot(data = region_hfi, aes(x = reorder(region, diff_ef_pf), 
                              y = diff_ef_pf, fill = score)) +
  geom_col() + 
  theme(axis.text.x = element_text(angle = 30)) +
  labs(x = "Region", y = "Diff in EF and PF Scores", 
       title = "Personal Freedom Lagging Behind 
       Economic Freedom in Developing Countries",
       subtitle = "Data from 162 countries from 2008-2017")
```

From our graph, it appears that economic freedom is significantly higher than personal freedom in developing countries, particularly in the Middle East & North Africa. Meanwhile, personal freedom appears to be much higher than economic freedom in developed countries, particularly in Western countries.

### Correlation Between Economic and Personal Freedom

```{r corr-ef-pf}
corr_efpf <- no_na_hfi %>% 
  summarize(cor_ef_pf = cor(as.numeric(ef_score), as.numeric(pf_score)))
corr_efpf
```

```{r corr-ef-pf-scatterplot, warning=FALSE, message=FALSE}
ggplot(data = no_na_hfi, aes(x = as.numeric(ef_score), 
                             y = as.numeric(pf_score))) +
  geom_point(alpha = 0.5, position = "jitter") + 
  geom_smooth(method="lm") +
  labs(x = "Economic Freedom Score", y = "Personal Freedom Score", 
       title = "Positive Correlation Between Economic and Personal Freedom",
       subtitle = "Data from 162 countries from 2008-2017")
```

It appears that there is a positive and linear relationship between economic freedom score and personal freedom score.

* It appears that there is a lower limit to economic freedom, compared to personal freedom.

### Relationship Between Freedom and Cold War Status

Mean Government Size From 2008-2017, Post-Soviet and NATO Countries

```{r coldwar, warning=FALSE, message=FALSE}
hfi_coldwar <- hfi %>% 
  mutate(post_soviet = ifelse(countries == "Russia" | 
                                countries == "Ukraine" | 
                                countries == "Moldova" | 
                                countries == "Uzbekistan" | 
                                countries == "Kazakhstan" | 
                                countries == "Kyrgyzstan" | 
                                countries == "Tajikistan" | 
                                countries == "Turkmenistan" | 
                                countries == "Georgia" | 
                                countries == "Azerbaijan" | 
                                countries == "Armenia" | 
                                countries == "Lithuania" | 
                                countries == "Latvia" | 
                                countries == "Estonia", "yes", "no")) %>% 
  mutate(nato = ifelse(countries == "Belgium" | 
                         countries == "Canada" | 
                         countries == "Denmark" | 
                         countries == "France" | 
                         countries == "Germany" | 
                         countries == "Greece" | 
                         countries == "Iceland" | 
                         countries == "Italy" | 
                         countries == "Luxembourg" | 
                         countries == "Netherlands" | 
                         countries == "Norway" | 
                         countries == "Portugal" | 
                         countries == "Spain" | 
                         countries == "Turkey" | 
                         countries == "United Kingdom" | 
                         countries == "United States", "yes", "no")) %>% 
  filter(post_soviet == "yes" | nato == "yes") %>% 
  mutate(coldwar_side = ifelse(post_soviet == "yes", "soviet", "western"))
  

ef_govt_coldwar <- hfi_coldwar %>% 
  filter(ef_government != "-") %>% 
  select(countries, coldwar_side, year, ef_government) %>% 
  group_by(year, coldwar_side) %>% 
  mutate(mean_ef_government = mean(as.numeric(ef_government)))

ggplot(data = ef_govt_coldwar, 
       aes(x = as.factor(year), y = mean_ef_government, group = coldwar_side, color = coldwar_side)) +
  geom_line(stat = "identity") +
  labs(x = "Year", y = "Smaller Government", 
       title = "Post-Soviet Countries Have Smaller Governments Than Western Countries",
       subtitle = "2008 to 2017, Higher Score = Smaller Government") +
  theme(axis.line.y = element_line(arrow = arrow()))

hf_coldwar <- hfi_coldwar %>% 
  filter(hf_score != "-") %>% 
  select(countries, coldwar_side, year, hf_score) %>% 
  group_by(year, coldwar_side) %>% 
  mutate(mean_hf = mean(as.numeric(hf_score)))

ggplot(data = hf_coldwar, 
       aes(x = as.factor(year), y = mean_hf, group = coldwar_side, color = coldwar_side)) +
  geom_line(stat = "identity") +
  labs(x = "Year", y = "Human Freedom Score", 
       title = "Post-Soviet Countries Less Free Than Western Countries",
       subtitle = "2008 to 2017")
```

It appears that former Soviet countries' governments have been decreasing in size, while Western countries' governments have been increasing in size. Smaller government doesn't necessarily lead to more freedom.

Remaining Questions to Explore:
- It appears that a bit of economic regulation could be beneficial toward a region's personal freedom and overall freedom. Examine certain lower scores in economic freedom in areas with high overall freedom.
- Look at relationship between size of government and freedom
- Look at relationship between regulation and overall freedom

###Women's freedom stuff
```{r unweighting-wsf, message = FALSE}
hfi <- hfi%>%
  mutate(pf_movement_nowomen = (as.numeric(pf_movement_domestic) 
                                + as.numeric(pf_movement_foreign))/2)
hfi <- hfi%>%
  mutate(pf_ss_nowomen = (as.numeric(pf_ss_homicide) 
                          + as.numeric(pf_ss_disappearances))/2)
hfi <- hfi%>%
  mutate(pf_identity_nowomen = (as.numeric(pf_identity_legal) 
                          + as.numeric(pf_identity_sex_male))/2)

hfi <- hfi%>%
  mutate(pf_rol = as.numeric(pf_rol))%>%
  mutate(pf_religion = as.numeric(pf_religion))%>%
  mutate(pf_association = as.numeric (pf_association))%>%
  mutate(pf_expression = as.numeric(pf_expression))%>%
  mutate(ef_score = as.numeric(ef_score))%>%
  mutate(hfi_women_unweighted = (ef_score * 0.5) 
         + (pf_rol * 0.125)
         + (pf_ss_nowomen * 0.125)
         + (pf_movement_nowomen * 0.05)
         + (pf_identity_nowomen * 0.05)
         + (pf_expression * 0.05)
         + (pf_association * 0.05)
         + (pf_religion * 0.05))
hfi <- hfi%>%
  mutate(pf_score_nowomen = (pf_rol * 0.25)
         + (pf_ss_nowomen * 0.25)
         + (pf_movement_nowomen * 0.1)
         + (pf_identity_nowomen * 0.1)
         + (pf_expression * 0.1)
         + (pf_association * 0.1)
         + (pf_religion * 0.1))

#what to do about na values?
#note: include in methodology why you did math this way

```


```{r correlation-women-vs-overall}
ws_only <- hfi%>%
  select(pf_ss_women, pf_ss_women_fgm, pf_ss_women_inheritance, 
         pf_ss_women_inheritance_daughters, pf_ss_women_inheritance_widows,
         pf_movement_women, pf_identity_sex_female, pf_identity_divorce, hfi_women_unweighted)
ws_only <- ws_only%>%
  mutate(pf_ss_women = as.numeric(pf_ss_women))%>%
  mutate(pf_movement_women = as.numeric(pf_movement_women))%>%
  mutate(pf_identity_divorce = as.numeric(pf_identity_divorce))%>%
  mutate(pf_identity_sex_female = as.numeric(pf_identity_sex_female))%>%

  mutate(ws_score = (((pf_identity_divorce + pf_identity_sex_female)/2) + pf_ss_women + pf_movement_women)/3)

ws_no_na <- ws_only%>%
    filter(!is.na(hfi_women_unweighted) & !is.na(ws_score)) 

corr_ws_hf <- ws_no_na%>%
  summarize(cor_ws_hfi = cor(hfi_women_unweighted, ws_score))
corr_ws_hf
```

```{r ws-hfi-scatter}
ggplot(data = ws_no_na, aes(x = ws_score, 
                             y = hfi_women_unweighted)) +
  geom_point(alpha = 0.5, position = "jitter") + 
  geom_smooth(method="lm") +
  labs(x = "Women-Specific Freedoms Score", y = "Overall Freedom Score", 
       title = "Positive Correlation Between Women-Specific and Overall Freedom",
       subtitle = "Data from 162 countries from 2008-2017")
```


{r ws-personal-economic-hyptohesis}
#can defintiely do simulation based
set.seed(10)
n_sims <- 2000
boot_dist = numeric(n_sims) 
for(i in 1:n_sims){ 
  indices <- sample(1:nrow(ws_no_na), replace = T)
  boot_cor <- ws_no_na %>% 
    slice(indices) %>%                    
    summarize(boot_cor = cor(ws_score, hfi_women_unweighted)) %>% 
    pull()                                
  boot_dist[i] <- boot_cor 
}

boot_cors = tibble(boot_dist)

mu_0 <- 0
offset <- boot_cors %>% 
  summarize(mu_0 - mean(boot_dist)) %>%
  pull()

boot_cors <- boot_cors %>%
  mutate(shifted_cors = boot_dist + offset)

boot_2 <- boot_cors%>%
  summarize(lower = quantile(shifted_cors, 0.005), 
            upper = quantile(shifted_cors, 0.995))
boot_2

Null hypothesis: There is no difference in the average correlation between w-s freedom to personal freedom and w-s freedom to economic freedom

Alt hypothesis: There is a difference in the average correlation between w-s freedom to personal freedom and w-s freedom to economic freedom

