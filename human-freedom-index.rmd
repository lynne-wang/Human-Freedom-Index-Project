---
title: "Human Freedom Index Project"
author: "Team Platypus: Lynne Wang, Neel Gajjar, Kate Neal"
output: pdf_document
---

```{r packages-data, warning=FALSE, message=FALSE}
library(tidyverse)
hfi <- read_csv("data/hfi_cc_2019.csv") 
```

```{r glimpse}
glimpse(hfi)
```

### Question 1

How has overall freedom around the world changed over time?

```{r q1, warning=FALSE, message=FALSE}
hfscore_by_year <- hfi %>% 
  filter(hf_score != "-") %>% 
  group_by(year) %>% 
  summarize(mean_hf = mean(as.numeric(hf_score)))

ggplot(data = hfscore_by_year, 
       aes(x = as.factor(year), y = mean_hf, group = 1)) +
  geom_line(stat = "identity") +
  ylim(6.75, 7.25) + 
  labs(x = "Year", y = "Human Freedom Score", 
       title = "Overall Human Freedom on the Decline",
       subtitle = "2008 to 2017")
```

### Question 2

How has overall freedom in the U.S. and China changed over time?

```{r q2, warning=FALSE, message=FALSE}
hfscore_china_us <- hfi %>% 
  filter(hf_score != "-" & 
           (countries == "China" | countries == "United States")) %>% 
  group_by(year, countries) %>% 
  summarize(mean_hf = mean(as.numeric(hf_score)))

ggplot(data = hfscore_china_us, 
       aes(x = as.factor(year), y = mean_hf, group = countries, color = countries)) +
  geom_line(stat = "identity")
```

### Question 3

In countries with the highest overall freedom scores, which freedoms are particularly high?

```{r q3, warning=FALSE, message=FALSE}
hfi %>% 
  filter(hf_rank != "-") %>% 
  group_by(countries) %>% 
  mutate(avg_rank = mean(as.numeric(hf_rank))) %>% 
  distinct(countries, avg_rank) %>% 
  arrange(desc(avg_rank)) %>% 
  summarize(countries, avg_rank)
```

### Question 4

What is the correlation between economic and personal freedom?

```{r q4}
hfi %>% 
  filter(pf_score != "-" & ef_score != "-") %>% 
  summarize(cor = cor(as.numeric(ef_score), as.numeric(pf_score)))

corr_efpf <- hfi %>% 
  filter(pf_score != "-" & ef_score != "-") %>% 
  group_by(countries) %>% 
  mutate(corr_ef_pf = cor(as.numeric(ef_score), as.numeric(pf_score))) %>% 
  distinct(countries, corr_ef_pf) %>% 
  summarize(countries, corr_ef_pf)

ggplot(data = corr_efpf, aes(x = corr_ef_pf)) +
  geom_histogram(bins = 20)
```

### ===========================================================================
### Economic and Personal Freedom

How do different countries' economic and personal freedom scores compare?

```{r economic-and-personal-freedom}
clean_hfi <- hfi %>% 
  filter(pf_score != "-" & ef_score != "-") %>% 
  group_by(countries) %>% 
  mutate(mean_pf = mean(as.numeric(pf_score)),
         mean_ef = mean(as.numeric(ef_score))) %>% 
  mutate(diff_ef_pf = mean_ef - mean_pf) %>% 
  slice(1) %>% 
  summarize(countries, mean_ef, mean_pf, diff_ef_pf)

mean_diff <- clean_hfi %>% 
  summarize(mean_diff = mean(diff_ef_pf))

ggplot(data = clean_hfi, aes(x = diff_ef_pf)) +
  geom_histogram(bins = 30) +
  geom_vline(linetype = "dashed", xintercept = c(mean_diff$mean_diff)) +
  labs(x = "Difference in Economic and Personal Freedom Score", 
       y = "Count", 
       title = "Histogram of Differences in Economic and Personal Freedom Score",
       subtitle = "Average Diffs from 2008 to 2017, 162 Countries")
```

### Economic and Personal Freedom Differences - Bootstrap Simulation

On average, is there a difference between a country's economic freedom score and personal freedom score?

Null Hypothesis: the difference between mean economic freedom score and mean personal freedom score is greater than or equal to zero.

Alternative Hypothesis: the difference between mean economic freedom score and mean personal freedom score is less than zero.

$H_0$: $\mu$ $\geq$ 0

$H_A$: $\mu$ < 0

```{r bootstrap-ef-pf-95-conf}
set.seed(10)
n_sims <- 500
boot_dist = numeric(n_sims) 
for(i in 1:n_sims){ 
  indices <- sample(1:nrow(clean_hfi), replace = T)
  boot_mean <- clean_hfi %>% 
    slice(indices) %>%                    
    summarize(boot_mean = mean(diff_ef_pf)) %>% 
    pull()                                
  boot_dist[i] <- boot_mean 
}

boot_means = tibble(boot_dist)
mu_0 <- 0
offset <- boot_means %>% 
  summarize(mu_0 - mean(boot_dist)) %>%
  pull()
boot_means <- boot_means %>%
  mutate(shifted_means = boot_dist + offset)
boot_1 <- boot_means%>%
  summarize(lower = quantile(shifted_means, 0.025), 
            upper = quantile(shifted_means, 0.975))
boot_1
```

```{r bootstrap-ef-pf-obs-diff}
obs_mean <- clean_hfi %>% 
  summarize(mean(diff_ef_pf)) %>% 
  pull()
obs_mean
```

```{r bootstrap-ef-pfp-val}
obs_diff <- mu_0 - obs_mean
boot_means %>% 
  mutate(extreme = ifelse(shifted_means <= mu_0 - obs_diff |
                          shifted_means >= mu_0 + obs_diff, 1, 0)) %>% 
  summarize(p_val = mean(extreme))
```

```{r bootstrap-ef-pf-visualization, warning=FALSE, message=FALSE}
ggplot(data = boot_means, aes(x = shifted_means)) +
  geom_histogram(color = "darkblue", fill = "skyblue") + 
  labs(x = "Difference in Economic and Personal Freedom Score", y = "Count", 
       title = "Sufficient Evidence to Suggest Difference Between 
       Economic and Personal Freedom Scores is Less than Zero",
       subtitle = "500 bootstrap reps with Observed Prop and 95% CI shown") +
  geom_vline(xintercept = c(boot_1$lower, boot_1$upper),
             color = "red") +
  geom_vline(linetype = "dashed", xintercept = c(mean_diff$mean_diff))
```

Our p-value is 0, and so we reject the null hypothesis at the $\alpha$ = 0.05 significance level. There is sufficient evidence to suggest that the difference between mean economic freedom score and mean personal freedom score is less than zero. In other words, on average, economic freedom scores tend to be lower than personal freedom scores around the world.

### Economic and Personal Freedom Difference By Region

```{r region-economic-personal-diff, warning=FALSE, message=FALSE}
region_hfi <- hfi %>% 
  filter(pf_score != "-" & ef_score != "-") %>% 
  group_by(region) %>% 
  mutate(mean_pf = mean(as.numeric(pf_score)),
         mean_ef = mean(as.numeric(ef_score))) %>% 
  mutate(diff_ef_pf = mean_ef - mean_pf,
         score = ifelse(diff_ef_pf > 0, 
                        "ef_score > pf_score", "ef_score < pf_score")) %>% 
  slice(1) %>% 
  summarize(region, mean_ef, mean_pf, diff_ef_pf, score)

ggplot(data = region_hfi, aes(x = reorder(region, diff_ef_pf), 
                              y = diff_ef_pf, fill = score)) +
  geom_col() + 
  theme(axis.text.x = element_text(angle = 30)) +
  labs(x = "Region", y = "Diff in EF and PF Scores", 
       title = "Personal Freedom Lagging Behind 
       Economic Freedom in Developing Countries",
       subtitle = "Data from 162 countries from 2008-2017")
```

From our graph, it appears that economic freedom is significantly higher than personal freedom in developing countries, particularly in the Middle East & North Africa. Meanwhile, personal freedom appears to be much higher than economic freedom in developed countries, particularly in Western countries.

### Correlation Between Economic and Personal Freedom

```{r corr-ef-pf}
no_na_hfi <- hfi %>% 
  filter(pf_score != "-" & ef_score != "-")

corr_efpf <- no_na_hfi %>% 
  summarize(cor_ef_pf = cor(as.numeric(ef_score), as.numeric(pf_score)))
corr_efpf
```

```{r corr-ef-pf-scatterplot, warning=FALSE, message=FALSE}
ggplot(data = no_na_hfi, aes(x = as.numeric(ef_score), 
                             y = as.numeric(pf_score))) +
  geom_point(alpha = 0.5, position = "jitter") + 
  geom_smooth(method="lm") +
  labs(x = "Economic Freedom Score", y = "Personal Freedom Score", 
       title = "Positive Correlation Between Economic and Personal Freedom",
       subtitle = "Data from 162 countries from 2008-2017")
```


